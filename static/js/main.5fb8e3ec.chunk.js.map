{"version":3,"sources":["components/UploadZone.tsx","pdf/createCertificate.ts","components/Loader.tsx","components/AsyncContentComponent.tsx","oracles/_AbstractBlockcyptherOracle.ts","oracles/BitcoinOracle.ts","utils/readFile.tsx","utils/getAsByteArray.tsx","utils/uint8ArrayToHex.tsx","hash/blake2b256.ts","oracles/EthereumOracle.ts","oracles/LitecoinOracle.ts","oracles/DateOracle.ts","oracles/NytimesOracle.ts","App.tsx","index.tsx"],"names":["UploadZone","state","fileInputField","uploadClick","this","props","children","onFile","onFiles","onFileOver","onFilesOver","clickable","onFileOverMaybe","isFileOver","UploadZoneDiv","onClick","onDragEnter","event","stopPropagation","preventDefault","onDragOver","onDragExit","onDragEnd","onDrop","files","Array","from","dataTransfer","type","ref","element","click","onChange","target","React","styled","div","createCertificate","certificateFilename","hash","doc","jsPDF","text","blob","output","File","Loader","className","AsyncContentComponent","loading","content","setState","a","factorable","AbstractBlockcyptherOracle","name","title","dataTitles","ttl","fetch","toLowerCase","response","console","log","json","body","error","Error","BitcoinOracle","readFile","file","Promise","resolve","reject","reader","FileReader","addEventListener","result","readAsArrayBuffer","getAsByteArray","Uint8Array","uint8ArrayToHex","uint8Array","map","x","toString","padStart","join","blake2b256","input","context","blake2bInit","blake2bUpdate","hashUint8Array","blake2bFinal","EthereumOracle","LitecoinOracle","DateOracle","date","time","Date","getUTCFullYear","getUTCMonth","slice","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","NytimesOracle","firstTitle","rssParser","RssParser","parseURL","feed","items","ORACLES","App","AppDiv","certificateFile","zip","JSZip","generateAsync","zipFile","saveAs","oracle","getData","data","Object","entries","key","value","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.5fb8e3ec.chunk.js","sourcesContent":["import * as React from 'react';\nimport styled from 'styled-components';\n\nexport type IUploadZoneProps = React.PropsWithChildren<{\n    clickable?: boolean;\n    onFilesOver?: (isFileOver: boolean) => void;\n    onFiles: (file: File[]) => void;\n}>;\n\nexport interface IUploadZoneState { }\n\n\nexport class UploadZone extends React.Component<IUploadZoneProps, IUploadZoneState> {\n    state: IUploadZoneState = { fileInputField: null };\n\n\n    render() {\n        const { children, onFiles: onFile, onFilesOver: onFileOver, clickable } = this.props;\n        const onFileOverMaybe = (isFileOver: boolean) => {\n            if (onFileOver) {\n                onFileOver(isFileOver);\n            }\n        };\n\n        let uploadClick: () => void;\n\n        return (\n            <UploadZoneDiv\n                onClick={() => {\n                    if (clickable) {\n                        uploadClick();\n                    }\n                }}\n                onDragEnter={(event) => {\n                    event.stopPropagation();\n                    event.preventDefault();\n                }}\n                onDragOver={(event) => {\n                    event.stopPropagation();\n                    event.preventDefault();\n                    onFileOverMaybe(true);\n                }}\n                onDragExit={(event) => {\n                    event.stopPropagation();\n                    event.preventDefault();\n                    onFileOverMaybe(false);\n                }}\n                onDragEnd={(event) => {\n                    event.stopPropagation();\n                    event.preventDefault();\n                }}\n                onDrop={(event) => {\n                    event.preventDefault();\n                    event.stopPropagation();\n                    onFileOverMaybe(false);\n\n                    const files = Array.from(event.dataTransfer.files); // TODO: Maybe there should be event.dataTransfer.items handler\n                    onFile(files);\n                }}\n            >\n                <input\n                    type=\"file\"\n                    ref={(element) => {\n                        if (element) {\n                            uploadClick = () => {\n                                onFileOverMaybe(true);\n                                (element as HTMLInputElement).click();\n                            };\n                        }\n                    }}\n                    onChange={(event) => {\n                        if (!event || !event.target || !event.target.files) return;\n                        onFile(Array.from(event.target.files));\n                    }}\n                />\n\n                {children}\n            </UploadZoneDiv>\n        );\n    }\n}\n\nconst UploadZoneDiv = styled.div`\n\n    width: 200px;\n    height: 300px;\n    border: 5px dashed #009edf;\n\n\n    input{\n        display: none;\n    }\n\n`","import { jsPDF } from \"jspdf\";\n\ninterface ICreateCertificateOptions {\n    certificateFilename: string;\n    hash: string;\n}\n\n// TODO: Maybe should return Blob\nexport function createCertificate({ certificateFilename, hash }: ICreateCertificateOptions) {\n    // Default export is a4 paper, portrait, using millimeters for units\n    const doc = new jsPDF();\n\n    doc.text(`Your BLAKE2b file hash is:\\n${hash}`, 10, 10);\n\n\n    const blob = doc.output('blob');\n\n\n    return new File([blob], certificateFilename, /* TODO: Maybe add current {lastModified: 1534584790000}*/);\n\n}","import * as React from 'react';\n\nexport function Loader() {\n    return (\n        <div className=\"loading-overlay\">\n            {/* TODO: Please @roseckyj  loader that would cover only its area not the whole modal, */}\n            {/* TODO: Please @roseckyj make it universal to use it in every layout type - small icon, fullscreen, modal, etc,... */}\n            {/* TODO: Please @roseckyj untite with LoaderInline */}\n            <div className=\"spinner\"></div>\n        </div>\n    );\n}","import * as React from 'react';\nimport { Loader } from './Loader';\n\nexport type IAwaitable<T> = T | Promise<T>;\n\nexport type IFactory<T> = () => T;\n\nexport type IFactorable<T> = T | IFactory<T>;\n\n\nexport function factor<T>(factorable: IFactorable<T>): T {\n    if (typeof factorable === 'function') {\n        return (factorable as any)();\n    } else {\n        return factorable;\n    }\n}\n\ninterface IAsyncContentComponentProps {\n    /**\n     * Component to be rendered before the content is loaded\n     *\n     * If not set, default loading is used\n     */\n    loading?: JSX.Element;\n\n    /**\n     * The async content to be rendered\n     */\n    content: IFactorable<IAwaitable<JSX.Element>>;\n}\n\ninterface IAsyncContentComponentState {\n    content: JSX.Element;\n}\n\n/**\n * Utility for mounting RxJS observable content\n *\n * @collboard-modules-sdk\n */\nexport function AsyncContentComponent({ loading, content }: IAsyncContentComponentProps) {\n    const [state, setState] = React.useState<IAsyncContentComponentState>({ content: loading || <Loader /> });\n\n    React.useEffect(() => {\n        (async () => {\n            setState({ content: await factor(content) });\n        })();\n\n        return () => {\n            /* TODO: Can here be some reasonable teardown logic? */\n        };\n    }, [content]);\n\n    return <>{state.content}</>;\n}","import { IOracle } from './_IOracle';\n\nexport abstract class AbstractBlockcyptherOracle implements IOracle<{ hash: string }> {\n    public abstract name: string;\n    public abstract title: string;\n\n    public dataTitles = { hash: 'Current block hash' };\n    public ttl = -1;\n\n    public async getData() {\n        const response = await fetch(\n            `https://api.blockcypher.com/v1/${this.name.toLowerCase()}/main` /*`https://blockchain.info/latestblock`*/,\n            /*{ mode: 'no-cors' }*/\n        );\n        console.log({ response });\n        const body = await response.json();\n\n        if (body.error) {\n            throw new Error(body.error);\n        }\n\n        const { hash } = body;\n        return { hash };\n    }\n}\n","import { AbstractBlockcyptherOracle } from \"./_AbstractBlockcyptherOracle\";\n\nexport class BitcoinOracle extends AbstractBlockcyptherOracle {\n    public name = 'BTC';\n    public title = 'Bitcoin';\n}","export function readFile(file: File): Promise<ArrayBuffer> {\n  return new Promise((resolve, reject) => {\n    // Create file reader\n    let reader = new FileReader();\n\n    // Register event listeners\n    reader.addEventListener(\"loadend\", event => resolve(event.target!.result as ArrayBuffer));\n    reader.addEventListener(\"error\", reject);\n\n    // Read file\n    reader.readAsArrayBuffer(file);\n  });\n}\n","import { readFile } from './readFile';\n\nexport async function getAsByteArray(file: File): Promise<Uint8Array> {\n  return new Uint8Array(await readFile(file));\n}\n","export function uint8ArrayToHex(uint8Array: Uint8Array) {\n  return [...uint8Array].map(x => x.toString(16).padStart(2, '0')).join('');\n}\n","\n// @ts-ignore: no typings\nimport { blake2bInit, blake2bUpdate, blake2bFinal } from 'blakejs';\nimport { getAsByteArray } from '../utils/getAsByteArray';\nimport { uint8ArrayToHex } from '../utils/uint8ArrayToHex';\n\n\nexport async function blake2b256(input: File): Promise<string> {\n\n    const KEY = null // optional key\n    const OUTPUT_LENGTH = 32 // bytes\n    const context = blake2bInit(OUTPUT_LENGTH, KEY)\n\n    // each time you get a byte array from the stream:\n    blake2bUpdate(context, await getAsByteArray(input));\n\n    // finally, once the stream has been exhausted\n    const hashUint8Array = blake2bFinal(context)\n    // returns a 64-byte hash, as a Uint8Array\n\n    const hash = uint8ArrayToHex(hashUint8Array);\n\n    return hash;\n\n}","import { AbstractBlockcyptherOracle } from \"./_AbstractBlockcyptherOracle\";\n\nexport class EthereumOracle extends AbstractBlockcyptherOracle {\n    public name = 'ETH';\n    public title = 'Ethereum';\n}","import { AbstractBlockcyptherOracle } from './_AbstractBlockcyptherOracle';\n\nexport class LitecoinOracle extends AbstractBlockcyptherOracle {\n    public name = 'LTC';\n    public title = 'Litecoin';\n}\n","import { IOracle } from './_IOracle';\n\nexport class DateOracle implements IOracle<{ date: string; time: string }> {\n    public name = 'DATE';\n    public title = 'Current';\n    public ttl = 1;\n\n    public dataTitles = { date: 'date', time: 'time' };\n\n    public getData() {\n        const date = new Date();\n        return {\n            date: `${date.getUTCFullYear()}-${('0' + date.getUTCMonth()).slice(-2)}-${('0' + date.getUTCDate()).slice(\n                -2,\n            )}`,\n            time: `${('0' + date.getUTCHours()).slice(-2)}:${('0' + date.getUTCMinutes()).slice(-2)}:${(\n                '0' + date.getUTCSeconds()\n            ).slice(-2)}`,\n        };\n    }\n}\n","import RssParser from 'rss-parser';\nimport { IOracle } from './_IOracle';\n\nexport class NytimesOracle implements IOracle<{ firstTitle: string }> {\n    public name = 'NYTIMES';\n    public title = 'The New York Times';\n    public ttl = -1;\n\n    public dataTitles = { firstTitle: 'first title' };\n\n    public async getData() {\n        const rssParser = new RssParser();\n        const feed = await rssParser.parseURL(`https://rss.nytimes.com/services/xml/rss/nyt/World.xml`);\n\n        // console.log({ feed });\n\n        return {\n            firstTitle: feed.items[0].title as string,\n        };\n    }\n}\n","import React from 'react';\nimport { UploadZone } from './components/UploadZone';\nimport styled from 'styled-components';\nimport { createCertificate } from './pdf/createCertificate';\nimport JSZip from 'jszip';\nimport { saveAs } from 'file-saver';\nimport { AsyncContentComponent } from './components/AsyncContentComponent';\nimport { BitcoinOracle } from './oracles/BitcoinOracle';\nimport { blake2b256 } from './hash/blake2b256';\nimport { EthereumOracle } from './oracles/EthereumOracle';\nimport { LitecoinOracle } from './oracles/LitecoinOracle';\nimport { DateOracle } from './oracles/DateOracle';\nimport { NytimesOracle } from './oracles/NytimesOracle';\n\nconst ORACLES = [\n    new BitcoinOracle(),\n    new EthereumOracle(),\n    new LitecoinOracle(),\n    new DateOracle(),\n    new NytimesOracle(),\n];\n\nexport function App() {\n    return (\n        <AppDiv>\n            {/*\n        <button\n          onClick={() => { console.log('test'); createCertificate() }}\n        >\n          Create document\n        </button>*/}\n            <h1>Sigmastamp</h1>\n\n            <UploadZone\n                onFiles={async (files) => {\n                    const file = files[0];\n\n                    const hash = await blake2b256(file);\n\n                    console.log({ files, file, hash });\n\n                    const certificateFile = createCertificate({ certificateFilename: 'certificate.pdf', hash });\n\n                    const zip = new JSZip();\n                    zip.file(file.name, file);\n                    zip.file(certificateFile.name, certificateFile);\n\n                    const zipFile = await zip.generateAsync({ type: 'blob' });\n                    saveAs(zipFile, 'certificate.zip');\n                }}\n                clickable\n            >\n                Upload your file(s) here!\n            </UploadZone>\n\n            {ORACLES.map((oracle) => (\n                <div key={oracle.name}>\n                    <AsyncContentComponent\n                        content={async () => {\n                            const data = await oracle.getData();\n\n                            return (\n                                <>\n                                    {Object.entries(data).map(([key, value]) => (\n                                        <div key={key}>\n                                            <b>\n                                                {/* @ts-ignore: Object.entries is dummy and cannot pass propper index signature type */}\n                                                {oracle.title} {oracle.dataTitles[key]}:\n                                            </b>{' '}\n                                            {value}\n                                        </div>\n                                    ))}\n                                </>\n                            );\n                        }}\n                    />\n                </div>\n            ))}\n        </AppDiv>\n    );\n}\n\nconst AppDiv = styled.div``;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport {App} from './App';\nimport './index.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}